#!/bin/bash
# Source: https://github.com/l0b0/tilde/blob/master/.bash_aliases#L64

printUsage()
{
    cat <<HELPTEXT
Print the directory that is common to all passed FILESPECs.
HELPTEXT
    echo
    printf 'Usage: %q %s\n' "$(basename "$1")" '[--] FILESPEC [...] [-?|-h|--help]'
}
case "$1" in
    --help|-h|-\?)	shift; printUsage "$0"; exit 0;;
    --)			shift;;
esac
if [ $# -eq 0 ]; then
    printUsage >&2 "$0"
    exit 2
elif [ $# -eq 1 ]; then
    printf '%s\n' "${1%/*}"
    exit
fi

# Remove repeated slashes.
for param
do
    param="$(printf %s. "$1" | tr -s /)"
    set -- "$@" "${param%.}"
    shift
done

common_path="$1"
shift

for param
do
    while case "${param%/}/" in "${common_path%/}/"*) false;; esac; do
	new_common_path="${common_path%/*}"
	[ "$new_common_path" = "$common_path" ] && exit 1 # Dead end
	common_path="$new_common_path"
    done
done
[ -z "$common_path" ] && exit 1
printf '%s\n' "$common_path"
